#!/usr/bin/env bash
set -euo pipefail
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
BASE_DIR="$(cd "${SCRIPT_DIR}/.." && pwd)"

show_help() {
  cat <<'EOF'
Query logs backend by trace_id.

Usage:
  bin/otel/cmds/trace2logs <trace_id> [--limit N] [--since DURATION] [--service NAME] [--span SPAN_ID]

Options:
  --limit N         Max number of log lines (default: 100)
  --since DURATION  Time range like 1h, 30m (default: 1h)
  --service NAME    Service name (default: OTEL_SERVICE_NAME)
  --span SPAN_ID    Span ID to filter logs

Output columns:
  timestamp  level  message

Note: Queries the logs backend for application logs correlated with the trace.
Span IDs from Tempo are base64; this tool normalizes to hex for log queries.
If no span-scoped logs exist, it falls back to trace-level logs.
EOF
}

if [[ $# -lt 1 || "${1:-}" == "-h" || "${1:-}" == "--help" ]]; then
  show_help
  exit 0
fi

exec "${BASE_DIR}/_python" "${BASE_DIR}/trace_tools.py" trace2logs "$@"
